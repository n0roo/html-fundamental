<html>
    <head>
    </head>
    <body>
        <div>
            <form id="form">
                <input type="text" id="input">
                <button id="check">확인</button>
            </form>
        </div>
        <div id="alert"></div>
        <div id="counting"></div>
        <script>
            const $alert = document.querySelector('#alert')
            const $input = document.querySelector('#input');
            const $form = document.querySelector('#form');
            const $counting = document.querySelector('#counting');

            const sampleNum = [1,2,3,4,5,6,7,8,9];
            const randomNum = [];
            // 정답을 만드는 알고리즘
            for(i = 0; i < 3; i += 1){ // 랜덤으로 뽑을 숫자의 갯수를 조절할수 있는 반복문
                let deleteIndex = Math.floor(Math.random() * (9 - i)); 
                // 0~9중의 정수 하나를 랜덤으로 생성하고 그 수는 sampleNum의 인덱스가 될것이다. 이때 sampleNum에서 인덱스 하나를 뽑아서 randomNum에 넣기때문에 반복문이 실행될때 마다 sampleNum의 인덱스는 하나씩 줄어든다.
                randomNum.push(sampleNum[deleteIndex]); // sampleNum중 랜덤한 index값 하나를 추출해 randomNum에 넣는다.
                sampleNum.splice(deleteIndex, 1); // 중복된 숫자가 뽑히지 않기 위해서 한번 생성되어 빠져나간 sampleNum의 인덱스는 삭제하는 로직이다.
            }
            console.log('정답 : ' + randomNum); // 확인용으로 콘솔에 정답 띄우기

            const tryAnswer = [];
            function checkInput(input) {
                if(input.length !== 3) {
                    const alertLength = document.createTextNode(`3자리만 입력가능합니다.`, document.createElement('br'));
                    $alert.appendChild(alertLength);
                    return;
                }
                if(new Set(input).size !== 3) {
                    const alertOverlap = document.createTextNode(`중복된 숫자는 입력 불가능합니다.`);
                    $alert.appendChild(alertOverlap);
                    return;
                }
                if(tryAnswer.includes(input)) {
                    const alertSameNum = document.createTextNode(`이미 시도한 숫자입니다.`);
                    $alert.appendChild(alertSameNum);
                    return;
                }
                return true;
            }

            let Strike = 0;
            let Ball = 0 ;   
            let countChance = 5;
            $form.addEventListener('submit', (event) => {
                event.preventDefault(); 
                const answer = event.target[0].value; //form 안에 이벤트 타겟중 첫번째의 벨류를 의미 즉,text
                $input.value = ''; // 입력후 텍스트칸 초기화
                
                    if(checkInput(answer)){
                        if(randomNum.join('') === answer) {
                        const winMessage = document.createTextNode('정답!!! 승리를 축하드립니다. ');
                        $counting.appendChild(winMessage);
                        return;
                        }
                        if(0 >= countChance) {
                            $counting.append(`${answer}: ${Strike}스트라이크 ${Ball}볼   남은 기회 : ${countChance}`, document.createElement('br'));
                            const loseMessage = document.createTextNode('패배!!! 정답은 : ' + randomNum + " 이였습니다.")
                            $counting.appendChild(loseMessage);                      
                            return;
                        }
                    }else{
                        return; 
                    }
                // Strike Ball 판정 알고리즘
                for(let i = 0; i < 3; i += 1) {
                    const answerTarget = answer.indexOf(randomNum[i]); // 정답의 첫번째부터 동일한 숫자가 있다면 그 값으로 반환
                    if(answerTarget > -1) { // 동일한 수가 존재하면 실행
                        if(i === answerTarget) { // 첫번째 자리수 부터 비교해서 같다면 스트라이크
                            Strike += 1;
                        } else { // 같은수는 있지만 자리가 같지 않다면 Ball+1
                            Ball += 1;
                        }
                    }
                   
                }
                {
                countChance--;
                $counting.append(`${answer}: ${Strike}스트라이크 ${Ball}볼   남은 기회 : ${countChance}`, document.createElement('br'));
                }
                tryAnswer.push(answer);
            });

        </script>
    </body>
</html>
